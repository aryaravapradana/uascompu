<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Hasil Evaluasi</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="container">
        <h1>Hasil Evaluasi Risiko</h1>

        <div class="summary-grid">
            <div class="summary-card">
                <i class="fas fa-user"></i>
                <span class="summary-label">Umur & Gender</span>
                <span class="summary-value">{{ umur }} th | {{ gender.title() }}</span>
            </div>
            <div class="summary-card">
                <i class="fas fa-weight-scale"></i>
                <span class="summary-label">BMI</span>
                <span class="summary-value">{{ '%.2f' % bmi }}</span>
            </div>
            <div class="summary-card">
                <i class="fas fa-bullseye"></i>
                <span class="summary-label">Target Jogging</span>
                <span class="summary-value">{{ target }} m</span>
            </div>
            <div class="summary-card">
                <i class="fas fa-triangle-exclamation"></i>
                <span class="summary-label">Tingkat Parah</span>
                <span class="summary-value">{{ tingkat_parah }}</span>
            </div>
            <div class="summary-card">
                <i class="fas fa-heart-pulse"></i>
                <span class="summary-label">Abnormal HR</span>
                <span class="summary-value small">{{ 'Ya' if abnormal_hr else 'Tidak' }}</span>
            </div>
        </div>

        <h2 class="mt-6">Persentase Risiko:</h2>

        <div class="risk-grid">
            {% if hasil %}
                {% for penyakit, persen in hasil %}
                    {% set circumference = 2 * 3.14159 * 34 %}
                    {% set offset = circumference - (persen / 100 * circumference) %}
                    {% set index = loop.index0 %}

                    {# --- KAMUS DESKRIPSI PENYAKIT (KUNCI HURUF KECIL & SPASI) --- #}
                    {% set disease_details = {
                        'aritmia': {'desc': 'Irama jantung tidak normal (cepat, lambat, atau tak teratur).', 'icon': 'fas fa-wave-square'},
                        'kardiomiopati': {'desc': 'Penyakit otot jantung yang lemahkan kemampuan memompa.', 'icon': 'fas fa-heart-pulse'},
                        'penyakit jantung koroner': {'desc': 'Penyempitan arteri koroner kurangi aliran darah jantung.', 'icon': 'fas fa-heart-crack'},
                        'gagal jantung': {'desc': 'Jantung tidak mampu memompa darah secara efektif.', 'icon': 'fas fa-shield-heart'},
                        'serangan jantung': {'desc': 'Kerusakan otot jantung akibat aliran darah terhenti.', 'icon': 'fas fa-bolt'},
                        'hipertensi pulmonal': {'desc': 'Tekanan darah tinggi pada arteri paru-paru.', 'icon': 'fas fa-lungs'},
                        'penyakit katup jantung': {'desc': 'Satu atau lebih katup jantung tidak berfungsi dengan baik, menyebabkan gangguan aliran darah.', 'icon': 'fas fa-lungs'},
                        'endokarditis': {'desc': 'Infeksi pada lapisan dalam dan katup jantung.', 'icon': 'fas fa-bacterium'},
                        'perikarditis': {'desc': 'Peradangan pada kantung pelapis jantung (perikardium).', 'icon': 'fas fa-shield-virus'},
                        'penyakit arteri perifer': {'desc': 'Penyempitan arteri yang kurangi aliran darah ke tungkai.', 'icon': 'fas fa-person-walking'},
                        'fibrilasi atrium': {'desc': 'Detak serambi jantung cepat & tidak teratur.', 'icon': 'fas fa-arrows-spin'},
                        'blok jantung': {'desc': 'Gangguan sinyal listrik yang perlambat detak jantung.', 'icon': 'fas fa-ban'},
                        'stroke': {'desc': 'Gangguan suplai darah ke otak sebabkan kerusakan sel.', 'icon': 'fas fa-brain'},
                        'cardiac arrest': {'desc': 'Henti jantung mendadak akibat gangguan listrik fatal.', 'icon': 'fas fa-plug-circle-xmark'},
                        'aterosklerosis': {'desc': 'Pengerasan & penyempitan arteri akibat penumpukan plak.', 'icon': 'fas fa-road-barrier'},
                        'lainnya': {'desc': 'Faktor risiko kesehatan lain yang perlu diwaspadai.', 'icon': 'fas fa-question-circle'}
                    } %}
                    {# --- Pencarian menggunakan kunci 'penyakit' yang sekarang DIASUMSIKAN huruf kecil & spasi --- #}
                    {% set current_disease_info = disease_details.get(penyakit, {'desc': 'Info belum tersedia.', 'icon': 'fas fa-info-circle'}) %}

                    <div class="result-item {% if persen > 20 %}risk-high{% endif %}" style="--index: {{ index }};">
                        <div class="disease-info">
                            {# --- Menampilkan judul dengan .title() agar kapital di awal kata --- #}
                            <div class="disease-title">{{ penyakit.title() }}</div>
                            <p class="disease-description">{{ current_disease_info.desc }}</p>
                        </div>
                        <div class="percentage-chart">
                            <svg class="percentage-svg" viewBox="0 0 80 80">
                                <circle class="circle-bg" cx="40" cy="40" r="34"></circle>
                                <circle class="circle-progress" cx="40" cy="40" r="34"
                                        stroke-dasharray="{{ circumference }}"
                                        style="--offset: {{ offset }};">
                                </circle>
                            </svg>
                            <div class="percentage-text">{{ persen }}%</div>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <p>Tidak ada data risiko yang tersedia.</p>
            {% endif %}
        </div>

        <div class="mt-6">
            <a href="/">← Kembali ke Form</a>
        </div>
    </div>
</body>
</html>